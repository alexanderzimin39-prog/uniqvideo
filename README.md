# Уникализатор видео + Telegram-бот

Проект содержит:
- `1.py` — исходный CLI-скрипт для уникализации.
- `video_unique.py` — модуль с функцией `unique_video()` для переиспользования.
- `bot.py` — Telegram-бот на aiogram v3, принимает видео и возвращает N уникальных копий.
- `requirements.txt` — зависимости.
- `Dockerfile` — контейнер со встроенным ffmpeg для деплоя.

## Быстрый старт (локально)

1) Установите зависимости (рекомендуется virtualenv):
```
pip install -r requirements.txt
```

2) Создайте файл `.env` с токеном бота:
```
BOT_TOKEN=ваш_токен_бота
WORKERS=2
```

3) Запустите бота:
```
python bot.py
```

Отправьте боту видео (как видео или документ). Бот спросит количество копий (1–5) и вернет готовые файлы.

## Запуск в Docker

Собрать образ и запустить:
```
docker build -t uniq-bot .
```

Запустить контейнер, передав токен через переменные окружения:
```
docker run --rm -e BOT_TOKEN=ваш_токен_бота -e WORKERS=2 uniq-bot
```

## Деплой на хостинг

Подойдет любой хостинг контейнеров (Koyeb, Fly.io, Railway, VPS). Требования:
- Python 3.11+
- ffmpeg установлен в образе/системе (в Dockerfile уже есть)
- Переменная окружения `BOT_TOKEN`

### Деплой на Koyeb (рекомендуется)

1. Запушьте проект в GitHub.
2. Войдите на [https://www.koyeb.com/](https://www.koyeb.com/) и нажмите "Create App".
3. Источник: GitHub → выберите репозиторий с этим проектом.
4. Build & Deploy:
   - Builder: Dockerfile
   - Dockerfile path: `Dockerfile`
   - Build context: `/` (корень репозитория)
5. Routing:
   - Отключите публичный HTTP-доступ (бот работает по long polling, порт не требуется).
6. Instance type: выберите бесплатный план (Free / Small, если доступно).
7. Environment variables:
   - `BOT_TOKEN` = ваш токен бота
   - `WORKERS` = 2 (по желанию)
   - `MAX_COPIES` = 10
8. Нажмите Deploy. Логи доступны на вкладке Logs.

Примечание: на бесплатном плане ресурсы и время выполнения ограничены. Обработка больших видео может занимать значительное время.

## Использование модуля `video_unique.py` отдельно

```python
from video_unique import unique_video

outputs = unique_video("/path/to/video.mp4", copies=3)
print(outputs)  # список путей к созданным файлам
```

Аргументы:
- `input_path` — путь к исходному видео
- `copies` — количество копий (int)
- `output_dir` — папка для вывода (по умолчанию `unique/` рядом с исходником)
- `progress_cb` — необязательный callback для прогресса

## Замечания
- Обработка видео ресурсоемкая; на бесплатных тарифах хостинга возможно ограничение по времени выполнения.
- Максимум одновременно обрабатываемых задач регулируется `WORKERS`.
- Бот скачивает файл во временную папку и удаляет её после отправки результатов.
